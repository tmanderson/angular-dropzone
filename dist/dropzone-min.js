angular.module("ui.dropzone",[]).value("utils",{closest:function(e,n){if(!e)return null;for(var t=e;t.parentNode&&!t.matches(n);)t=t.parentNode;return t.parentNode?t:!1}}).run(["utils",function(e){var n,t,d,o,r=e.closest;document.addEventListener("drag",function(e){if(d){if(o.top+o.height/2<e.pageY){if(d.classList.remove("dropzone-displaced"),d.nextElementSibling===t)return;return d=d.nextElementSibling||d,o=d&&d.getBoundingClientRect()||null,d&&d.classList.add("dropzone-displaced")}d.classList.add("dropzone-displaced")}}),document.addEventListener("dragstart",function(e){t=e.target}),document.addEventListener("dragend",function(){}),document.addEventListener("dragover",function(e){e.preventDefault()}),document.addEventListener("dragenter",function(e){var i=r(e.target,"[dropzone]");if(i){var a,l,c,s=i.querySelectorAll("[droppable]");for(d&&!i.contains(d)&&(d.classList.remove("dropzone-displaced"),d=o=null),c=0;c<s.length;c++)if(a=s[c],a!==t){if(l=a.getBoundingClientRect(),l.bottom>e.pageY){d=a,o=a.getBoundingClientRect(),d.classList.add("dropzone-displaced");break}d=null}n=i}}),document.addEventListener("dragleave",function(e){var n=r(e.target,"[dropzone]");if(n)for(var t=n.querySelectorAll("[droppable]"),d=0;d<t.length;d++)t[d].classList.remove("dropzone-displaced")}),document.addEventListener("drop",function(){var e,i,a,l=r(t,"[dropzone]").children,c=n.children;for(e=0;e<l.length;e++)l[e]===t&&(i=e);for(e=0;e<c.length;e++){if(c[e]===d){a=e;break}e===c.length-1&&(a=e+1)}var s=new CustomEvent("dropzone-remove",{bubbles:!0,cancelable:!0,detail:{fromIndex:i,toIndex:a,dropzone:n}});t.dispatchEvent(s),d&&d.classList.remove("dropzone-displaced"),n=d=o=t=null})}]).directive("droppable",["utils",function(e){return{restrict:"A",link:function(n,t){t[0];t.attr("draggable",!0),t[0]._dropzone=e.closest(t[0],"[dropzone]")}}}]).directive("dropzone",["utils",function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,n){n[0];n.on("dropzone-add",function(t){n.children().removeClass("dropzone-displaced"),e.$emit("dropzone-add",t.detail),e.$apply(function(e){e.model.splice(t.detail.index,0,t.detail.data[0])})}),n.on("dropzone-remove",function(n){var t=new CustomEvent("dropzone-add",{bubbles:!0,cancelable:!0,detail:{index:n.detail.toIndex,data:e.model.splice(n.detail.fromIndex,1)}});e.$emit("dropzone-remove",n.detail),n.detail.dropzone.dispatchEvent(t)})}}}]);